# Google Maps API 設定ガイド（初心者向け）

## はじめに

このガイドでは、Google Maps APIキーを取得して、プロジェクトに設定する方法をステップバイステップで説明します。
プログラミングの経験が少ない方でも理解できるよう、図解とともに詳しく説明します。

---

## 📋 目次

1. [Google Maps APIとは？](#1-google-maps-apiとは)
2. [Google Cloud Consoleアカウントの準備](#2-google-cloud-consoleアカウントの準備)
3. [プロジェクトの作成](#3-プロジェクトの作成)
4. [Google Maps APIの有効化](#4-google-maps-apiの有効化)
5. [APIキーの作成](#5-apiキーの作成)
6. [APIキーの制限設定（セキュリティ）](#6-apiキーの制限設定セキュリティ)
7. [プロジェクトへの設定](#7-プロジェクトへの設定)
8. [動作確認](#8-動作確認)
9. [トラブルシューティング](#9-トラブルシューティング)

---

## 1. Google Maps APIとは？

Google Maps APIは、Googleが提供する地図サービスを自分のWebサイトに組み込むための仕組みです。

**簡単に言うと：**
- Google Mapsの地図を自分のサイトに表示できる
- 地図上にマーカー（目印）を表示できる
- 経路検索（道順）を表示できる

**このプロジェクトでの使い方：**
- 奄美大島の地図を表示
- 観光地やホテルなどの場所にマーカーを表示
- 出発地から目的地までの経路を表示

𝛁

## 2. Google Cloud Consoleアカウントの準備

### 2.1 Googleアカウントでログイン

1. **Google Cloud Console**にアクセス
   - URL: https://console.cloud.google.com/
   - Googleアカウントでログインします

2. **初めての場合は無料トライアルに申し込む**
   - 初回利用時は、無料トライアル（300ドルの無料クレジット）が提供されます
   - クレジットカード情報の登録が必要ですが、一定量和までは無料です
   - **注意**: 自動課金は設定できますが、制限を設定すれば安全です（後で説明します）

### 2.2 料金について

**良いニュース：**
- Google Maps APIには**毎月$200の無料クレジット**が提供されます
- 小規模なプロジェクトでは、ほぼ無料で利用できます

**このプロジェクトでの想定使用量：**
- 地図表示: 月に数百回程度
- 経路検索: 月に数十回程度
- **想定料金: ほぼ$0（無料枠内）**

---

## 3. プロジェクトの作成

### 3.1 新しいプロジェクトを作-aut文

1. Google Cloud Consoleのトップページで、**「プロジェクトを選択」**をクリック

2. **「新しいプロジェクト」**をクリック

3. プロジェクト情報を入力：
   - **プロジェクト名**: `amami-itinerary`（お好きな名前でOK）
   - **組織**: （個人の場合は選択不要）
   - **場所**: （選択不要でもOK）

4. **「作成」**をクリック

5. プロジェクトが作成されるまで数秒待ちます

### 3.2 プロジェクトを選択

作成したプロジェクトが自動的に選択されます。画面上部にプロジェクト名が表示されていることを確認してください。

---

## 4. Google Maps APIの有効化

### 4.1 APIライブラリを開く

1. 左側のメニューから **「APIとサービス」** → **「ライブラリ」** をクリック

2. 検索ボックスに **「Maps JavaScript API」** と入力

3. **「Maps JavaScript API」** をクリック

### 4.2 APIを有効化

1. **「有効にする」** ボタンをクリック

2. 数秒待つと、APIが有効化されます

### 4.3 追加のAPIを有効化（経路検索用）

経路検索機能を使うために、**Directions API**も有効化します：

1. **「APIとサービス」** → **「ライブラリ」** に戻る

2. 検索ボックスに **「Directions API」** と入力

3. **「Directions API」** をクリック

4. **「有効にする」** ボタンをクリック

**有効化すべきAPI一覧：**
- ✅ **Maps JavaScript API**（地図表示用）
- ✅ **Directions API**（経路検索用）

---

## 5. APIキーの作成

### 5.1 認証情報ページを開く

1. 左側のメニューから **「APIとサービス」** → **「認証情報」** をクリック

2. ページ上部の **「+ 認証情報を作成」** → **「APIキー」** をクリック

### 5.2 APIキーをコピー

1. APIキーが作成され、ポップアップが表示されます
2. **APIキーをコピー**してください（後で使います）
   - 例: `AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

3. **「閉じる」**をクリック

⚠️ **重要**: APIキーは秘密情報です。他人に共有しないでください！

---

## 6. APIキーの制限設定（セキュリティ）

APIキーを制限することで、不正使用を防ぎます。必ず設定しましょう。

### 6.1 APIキーの編集

1. **「認証情報」**ページで、作成したAPIキーをクリック

2. **「キーの制限」**セクションを展開

### 6.2 アプリケーションの制限

**「HTTPリファラー（ウェブサイト）」**を選択して、以下のURLを追加：

**開発環境（ローカル）：**
```
http://localhost:3000/*
```

**本番環境（Vercel）：**
```
https://your-project.vercel.app/*
```

**注意**: `your-project.vercel.app` は、実際のVercelデプロイURLに置き換えてください。

### 6.3 APIの制限

**「キーを制限」**を選択して、以下のAPIのみを許可：

- ✅ Maps JavaScript API
- ✅ Directions API

### 6.4 保存

**「保存」**ボタンをクリック

**設定の意味：**
- 指定したURLからのみAPIキーが使えるようになります
- 他のサイトでは使用できなくなります（セキュリティ向上）

---

## 7. プロジェクトへの設定

### 7.1 環境変数ファイルの作成

プロジェクトのルートディレクトリ（`package.json`がある場所）に、`.env.local`ファイルを作成します。

**ファイルの場所：**
```
/奄美大島2/
├── package.json
├── .env.local  ← ここに作成（新規ファイル）
└── ...
```

### 7.2 環境変数の設定

`.env.local`ファイルに、以下の内容を記述：

```env
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=あなたのAPIキー
```

**例：**
```env
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**重要ポイント：**
- `NEXT_PUBLIC_` というプレフィックスが必要です（Next.jsのルール）
- あなたのAPIキーは、手順5.2でコピーしたものです

### 7.3 .gitignoreの確認

`.gitignore`ファイルに`.env.local`が含まれているか確認してください。

**確認方法：**
プロジェクトのルートにある`.gitignore`ファイルを開き、以下が含まれているか確認：

```
.env.local
.env*.local
```

**含まれていればOK**です。含まれていない場合は追加してください（APIキーをGitにコミットしないため）。

### 7.4 開発サーバーの再起動

環境変数を変更したら、開発サーバーを再起動する必要があります。

**手順：**
1. ターミナルで`Ctrl + C`を押してサーバーを停止
2. 再度`npm run dev`を実行

---

## 8. 動作確認

### 8.1 環境変数が読み込まれているか確認

コードで環境変数が正しく読み込まれているか確認します。

**確認方法：**
`src/lib/maps/config.ts`を作成して（後で実装します）、以下のように記述：

```typescript
export const GOOGLE_MAPS_API_KEY = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;

if (!GOOGLE_MAPS_API_KEY) {
  throw new Error('Google Maps APIキーが設定されていません');
}

console.log('APIキーが読み込まれました:', GOOGLE_MAPS_API_KEY.substring(0, 10) + '...');
```

### 8.2 地図ページを開く

1. ブラウザで `http://localhost:3000/map` にアクセス
2. 地図が表示されれば成功です！

### 8.3 エラーが出る場合

ブラウザの開発者ツール（F12キー）のコンソールでエラーメッセージを確認してください。

**よくあるエラー：**
- `APIキーが設定されていません` → `.env.local`の設定を確認
- `RefererNotAllowedMapError` → APIキーの制限設定を確認

---

## 9. トラブルシューティング

### 問題1: 「APIキーが設定されていません」エラー

**原因：**
- `.env.local`ファイルが正しく作成されていない
- 環境変数の名前が間違っている
- 開発サーバーを再起動していない

**解決方法：**
1. `.env.local`ファイルがプロジェクトルートにあるか確認
2. ファイルの中身が正しいか確認（`NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=...`）
3. 開発サーバーを再起動（`npm run dev`）

### 問題2: 「RefererNotAllowedMapError」エラー

**原因：**
- APIキーの制限設定で、現在のURLが許可されていない

**解決方法：**
1. Google Cloud Console → 認証情報 → APIキーを編集
2. HTTPリファラーに `http://localhost:3000/*` が追加されているか確認
3. 保存して数分待つ（反映に時間がかかることがあります）

### 問題3: 地図が表示されない

**原因：**
- APIが有効化されていない
- APIキーが正しくない
- ネットワークエラー

**解決方法：**
1. Google Cloud Consoleで、Maps JavaScript APIが「有効」になっているか確認
2. APIキーが正しくコピーされているか確認（前後のスペースがないか）
3. ブラウザのコンソール（F12）でエラーメッセージを確認

### 問題4: 料金が心配

**解決方法：**
1. Google Cloud Console → 「請求」→「予算とアラート」
2. 予算アラートを設定（例：$10に達したら通知）
3. 「APIとサービス」→「ダッシュボード」で使用量を定期的に確認

**目安：**
- 地図表示1,000回 = 約$7
- 経路検索100回 = 約$5
- このプロジェクトの想定使用量では、無料枠内に収まる見込みです

---

## 10. 次のステップ

APIキーの設定が完了したら、次はコードの実装に進みます。

**実装順序：**
1. ✅ APIキーの設定（このガイド）
2. ⬜ 地図表示コンポーネントの作成
3. ⬜ マーカー表示の実装
4. ⬜ 経路検索機能の実装

---

## 📚 参考リンク

- [Google Maps Platform 料金](https://mapsplatform.google.com/pricing/)
- [Maps JavaScript API ドキュメント](https://developers.google.com/maps/documentation/javascript)
- [APIキーのベストプラクティス](https://cloud.google.com/docs/authentication/api-keys)

---

## 💡 まとめ

1. **Google Cloud Console**でプロジェクトを作成
2. **Maps JavaScript API**と**Directions API**を有効化
3. **APIキー**を作成してコピー
4. **APIキーの制限**を設定（セキュリティ）
5. **`.env.local`**ファイルにAPIキーを設定
6. **開発サーバーを再起動**

これでGoogle Maps APIの設定は完了です！🎉

質問や問題があれば、このガイドを参照してください。

